name: CI
on:
  pull_request:
    branches: ["staging"]
jobs:
  readytoreview:
    name: Auto Deploy Staging
    runs-on: ubuntu-latest
    steps:
      - name: Get Latest Code
        uses: actions/checkout@v4
      - name: Deploy via SFTP
        env:
          SFTP_USERNAME: ${{ secrets.USERNAME }}
          SFTP_PASSWORD: ${{ secrets.PASSWORD }}
          SFTP_HOST: ${{ secrets.HOST }}
        run: |
          lftp -e "
            set ssl:verify-certificate false;
            set ftp:ssl-force true;
            set sftp:auto-confirm yes;
            open -u $SFTP_USERNAME,$SFTP_PASSWORD sftp://$SFTP_HOST;
            lcd ./;
            cd /var/www/html/shop/wp-content/plugins/asd-passkey-login;
            mirror --reverse --verbose \
              --exclude '.git*' \
              --exclude 'README.md' \
              --exclude 'readme.md' \
              --exclude '.gitignore' \
              --exclude 'vendor' \
              --exclude 'composer.lock' \
              --exclude 'composer.json' \
              ./ ./;
            bye;
          "
